# Домашнее задание к занятию 17 «Инцидент-менеджмент» - Лепишин Алексей

## Задание

Составьте постмортем на основе реального сбоя системы GitHub в 2018 году.

Информацию о сбое можно изучить по ссылкам ниже:

* [краткое описание на русском языке](https://habr.com/ru/post/427301/);
* [развёрнутое описание на английском языке](https://github.blog/2018-10-30-oct21-post-incident-analysis/).

**Решение:**
| Раздел | Описание |
| --- | --- |
| Краткое описание инцидента | После потери связи между сетевым узлом и датацентром нарушилась топология кластеров оркестратора, что привело к деградированию системы |
| Предшествующие события | Плановые работы по замене вышедшего из строя 100G оптического оборудования в дата-центре |
| Причина инцидента | В результате временной потери связи кластеры MySQL перешли в "неожиданное" для оркестратора состояние |
| Воздействие | Отображение устаревшей информации, также не функционировали webhook и сборка и публикация github pages |
| Обнаружение | Инцидент был замечен дежурными инженерами через оповещения системы мониторинга |
| Реакция | Группа реагирования отключила часть сервисов для минимизации изменений БД, после чего подключились к работе координатор и разработчики из инженерной группы БД. Общее время восстановления составило 24 часа 11 минут |
| Восстановление | Для исключения потери данных временно отключили часть сервисов для мининизации накопления изменений, после восстановили данные из резервных копий, а на них реплицировали накопленные. Далее переконфигурировали топологию кластеров БД и включили деактивированный функционал. Затем дождались отработки накопленных задач для чего даже потребовалось временно развернуть дополнительные реплики на чтение |
| Таймлайн |  **21.10.2018 22:52** - нарушилась связь между сетевым узлом и основным дата-центром <br> **21.10.2018 22:52** - оркестратор в основном дата-центре запустил процесс выбора нового лидера, в результате чего начал создавать топологию кластера БД. После восстановления подключения приложения направили трафик по записи на новые основные сервера. Таким образом на обоих серверах образовались данные, отсутствующие у другого и не получилось вернуть первичный сервер <br> **21.10.2018 22:54** - внутренние системы мониторинга начали генерировать оповещения о сбоях в работе систем <br> **21.10.2018 23:02** - инженеры группы реагирования определили, что топологии для многочисленных кластеров БД находятся в состоянии, что при запросе api оркестратора отображалась топология репликации БД, содержащая только серверы из западного ДЦ <br> **21.10.2018 23:07** - группа реагирования заблокировала внутренние средства развёртывания чтобы предотвратить внесение дополнительных изменений в БД <br> **21.10.2018 23:09** - группа реагирования установила жёлтый статус работоспособности сайта <br> **21.10.2018 23:11** - координатор присоединился к работе и через 2 минуты принял решение изменить статус сайта на красный <br> **21.10.2018 23:13** - к работе привлекли дополнительных разработчиков из инженерной группы БД, которые начали исследовать текущее состояние для определения необходимых действий для ручной перенастроийки БД <br> **21.10.2018 23:19** - в целях сохранности данных принято решение об остановке выполнения заданий, которые пишут метаданные типа пуш-запросов <br> **22.10.2018 00:05** - инженеры из группы реагирования начали разрабатывать план устранения несогласованности данных и запустили процедуры отработки отказа для MySQL <br> **22.10.2018 00:41** - инициирован процесс резервного копирования для всех затронутых кластеров MySQL. Также несколько групп инженеров изучали способы ускорения передачи и восстановления без дальнейшей деградации сайта или риска повреждения данных <br> **22.10.2018 06:51** - несколько кластеров завершили восстановление из резервных копий и начали реплицировать новые данные с западным побережьем <br> **22.10.2018 07:46** - публикация информационного сообщения об инциденте <br> **22.10.2018 11:12** - все первичные БД вновь переведены на Восток, но некоторые данные всё ещё отставали на несколько часов из-за отложенных реплик <br> **22.10.2018 13:15** - зафиксировано возрастание отставания репликации до согласованного состояния. Начали подготовку дополнительных реплик чтения MySQL в общедоступном облаке <br> **22.10.2018 16:24** - завершена синхронизация реплик, возврат к исходной топологии, устраненены проблемы задержки и доступности, красный статус сохранён, так как нужно обработать накопленные данные <br> **22.10.2018 16:45** - включение всех деактивированных функций, корректировка TTL более 200000 истекших за время восстановления задач из более 5 миллионов <br> **22.10.2018 23:03** - все незавершённые события webhook и сборки pages обработаны, целостность и правильная работа всех систем подтверждена, статус сайта изменён на зелёный |
| Последующие действия | Введена системная практика проверки сценариев сбоев, прежде чем они возникнут в реальности (Chaos Engineering) |